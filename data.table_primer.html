<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Ethan Kang" />
  <title>data.table primer</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="data.table_primer_files/reveal.js-3.3.0.1/css/reveal.css"/>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="data.table_primer_files/reveal.js-3.3.0.1/css/theme/sky.css" id="theme">


  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }

    .reveal .slide-menu-button {
      left: 105px !important;
    }

  </style>

    <style type="text/css">code{white-space: pre;}</style>


<!-- Printing and PDF exports -->
<script id="paper-css" type="application/dynamic-css">

/* Default Print Stylesheet Template
   by Rob Glazebrook of CSSnewbie.com
   Last Updated: June 4, 2008

   Feel free (nay, compelled) to edit, append, and
   manipulate this file as you see fit. */


@media print {

	/* SECTION 1: Set default width, margin, float, and
	   background. This prevents elements from extending
	   beyond the edge of the printed page, and prevents
	   unnecessary background images from printing */
	html {
		background: #fff;
		width: auto;
		height: auto;
		overflow: visible;
	}
	body {
		background: #fff;
		font-size: 20pt;
		width: auto;
		height: auto;
		border: 0;
		margin: 0 5%;
		padding: 0;
		overflow: visible;
		float: none !important;
	}

	/* SECTION 2: Remove any elements not needed in print.
	   This would include navigation, ads, sidebars, etc. */
	.nestedarrow,
	.controls,
	.fork-reveal,
	.share-reveal,
	.state-background,
	.reveal .progress,
	.reveal .backgrounds {
		display: none !important;
	}

	/* SECTION 3: Set body font face, size, and color.
	   Consider using a serif font for readability. */
	body, p, td, li, div {
		font-size: 20pt!important;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		color: #000;
	}

	/* SECTION 4: Set heading font face, sizes, and color.
	   Differentiate your headings from your body text.
	   Perhaps use a large sans-serif for distinction. */
	h1,h2,h3,h4,h5,h6 {
		color: #000!important;
		height: auto;
		line-height: normal;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		text-shadow: 0 0 0 #000 !important;
		text-align: left;
		letter-spacing: normal;
	}
	/* Need to reduce the size of the fonts for printing */
	h1 { font-size: 28pt !important;  }
	h2 { font-size: 24pt !important; }
	h3 { font-size: 22pt !important; }
	h4 { font-size: 22pt !important; font-variant: small-caps; }
	h5 { font-size: 21pt !important; }
	h6 { font-size: 20pt !important; font-style: italic; }

	/* SECTION 5: Make hyperlinks more usable.
	   Ensure links are underlined, and consider appending
	   the URL to the end of the link for usability. */
	a:link,
	a:visited {
		color: #000 !important;
		font-weight: bold;
		text-decoration: underline;
	}
	/*
	.reveal a:link:after,
	.reveal a:visited:after {
		content: " (" attr(href) ") ";
		color: #222 !important;
		font-size: 90%;
	}
	*/


	/* SECTION 6: more reveal.js specific additions by @skypanther */
	ul, ol, div, p {
		visibility: visible;
		position: static;
		width: auto;
		height: auto;
		display: block;
		overflow: visible;
		margin: 0;
		text-align: left !important;
	}
	.reveal pre,
	.reveal table {
		margin-left: 0;
		margin-right: 0;
	}
	.reveal pre code {
		padding: 20px;
		border: 1px solid #ddd;
	}
	.reveal blockquote {
		margin: 20px 0;
	}
	.reveal .slides {
		position: static !important;
		width: auto !important;
		height: auto !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 0 !important;
		zoom: 1 !important;

		overflow: visible !important;
		display: block !important;

		text-align: left !important;
		-webkit-perspective: none;
		   -moz-perspective: none;
		    -ms-perspective: none;
		        perspective: none;

		-webkit-perspective-origin: 50% 50%;
		   -moz-perspective-origin: 50% 50%;
		    -ms-perspective-origin: 50% 50%;
		        perspective-origin: 50% 50%;
	}
	.reveal .slides section {
		visibility: visible !important;
		position: static !important;
		width: auto !important;
		height: auto !important;
		display: block !important;
		overflow: visible !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 60px 20px !important;
		z-index: auto !important;

		opacity: 1 !important;

		page-break-after: always !important;

		-webkit-transform-style: flat !important;
		   -moz-transform-style: flat !important;
		    -ms-transform-style: flat !important;
		        transform-style: flat !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;

		-webkit-transition: none !important;
		   -moz-transition: none !important;
		    -ms-transition: none !important;
		        transition: none !important;
	}
	.reveal .slides section.stack {
		padding: 0 !important;
	}
	.reveal section:last-of-type {
		page-break-after: avoid !important;
	}
	.reveal section .fragment {
		opacity: 1 !important;
		visibility: visible !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;
	}
	.reveal section img {
		display: block;
		margin: 15px 0px;
		background: rgba(255,255,255,1);
		border: 1px solid #666;
		box-shadow: none;
	}

	.reveal section small {
		font-size: 0.8em;
	}

}  
</script>


<script id="pdf-css" type="application/dynamic-css">
    
/**
 * This stylesheet is used to print reveal.js
 * presentations to PDF.
 *
 * https://github.com/hakimel/reveal.js#pdf-export
 */

* {
	-webkit-print-color-adjust: exact;
}

body {
	margin: 0 auto !important;
	border: 0;
	padding: 0;
	float: none !important;
	overflow: visible;
}

html {
	width: 100%;
	height: 100%;
	overflow: visible;
}

/* Remove any elements not needed in print. */
.nestedarrow,
.reveal .controls,
.reveal .progress,
.reveal .playback,
.reveal.overview,
.fork-reveal,
.share-reveal,
.state-background {
	display: none !important;
}

h1, h2, h3, h4, h5, h6 {
	text-shadow: 0 0 0 #000 !important;
}

.reveal pre code {
	overflow: hidden !important;
	font-family: Courier, 'Courier New', monospace !important;
}

ul, ol, div, p {
	visibility: visible;
	position: static;
	width: auto;
	height: auto;
	display: block;
	overflow: visible;
	margin: auto;
}
.reveal {
	width: auto !important;
	height: auto !important;
	overflow: hidden !important;
}
.reveal .slides {
	position: static;
	width: 100%;
	height: auto;

	left: auto;
	top: auto;
	margin: 0 !important;
	padding: 0 !important;

	overflow: visible;
	display: block;

	-webkit-perspective: none;
	   -moz-perspective: none;
	    -ms-perspective: none;
	        perspective: none;

	-webkit-perspective-origin: 50% 50%; /* there isn't a none/auto value but 50-50 is the default */
	   -moz-perspective-origin: 50% 50%;
	    -ms-perspective-origin: 50% 50%;
	        perspective-origin: 50% 50%;
}

.reveal .slides section {
	page-break-after: always !important;

	visibility: visible !important;
	position: relative !important;
	display: block !important;
	position: relative !important;

	margin: 0 !important;
	padding: 0 !important;
	box-sizing: border-box !important;
	min-height: 1px;

	opacity: 1 !important;

	-webkit-transform-style: flat !important;
	   -moz-transform-style: flat !important;
	    -ms-transform-style: flat !important;
	        transform-style: flat !important;

	-webkit-transform: none !important;
	   -moz-transform: none !important;
	    -ms-transform: none !important;
	        transform: none !important;
}

.reveal section.stack {
	margin: 0 !important;
	padding: 0 !important;
	page-break-after: avoid !important;
	height: auto !important;
	min-height: auto !important;
}

.reveal img {
	box-shadow: none;
}

.reveal .roll {
	overflow: visible;
	line-height: 1em;
}

/* Slide backgrounds are placed inside of their slide when exporting to PDF */
.reveal section .slide-background {
	display: block !important;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	z-index: -1;
}

/* All elements should be above the slide-background */
.reveal section>* {
	position: relative;
	z-index: 1;
}

/* Display slide speaker notes when 'showNotes' is enabled */
.reveal .speaker-notes-pdf {
	display: block;
	width: 100%;
	max-height: none;
	left: auto;
	top: auto;
	z-index: 100;
}

/* Display slide numbers when 'slideNumber' is enabled */
.reveal .slide-number-pdf {
	display: block;
	position: absolute;
	font-size: 14px;
}

</script>


<script>
var style = document.createElement( 'style' );
style.type = 'text/css';
var style_script_id = window.location.search.match( /print-pdf/gi ) ? 'pdf-css' : 'paper-css';
var style_script = document.getElementById(style_script_id).text;
style.innerHTML = style_script;
document.getElementsByTagName('head')[0].appendChild(style);
</script>

    <link href="data.table_primer_files/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">data.table primer</h1>
    <h2 class="author">Ethan Kang</h2>
    <h3 class="date">February 4, 2018</h3>
</section>

<section><section id="data.table-introduction-for-actuaries" class="titleslide slide level1"><h1>data.table introduction for actuaries</h1></section><section id="agenda" class="slide level2">
<h2>Agenda</h2>
<ul>
<li>What is data.table?</li>
<li>Why you should learn it?</li>
<li>data.table features in depth</li>
</ul>
</section><section id="data.table" class="slide level2">
<h2>data.table</h2>
<ul>
<li>A package that does tablular data manipulation</li>
<li>data.table inherits from data.frame in R</li>
<li>In memory computation provides fast data processing speed</li>
</ul>
</section><section id="benefits-of-using-data.table" class="slide level2">
<h2>Benefits of using data.table</h2>
<ul>
<li>Intuitive syntax of <code>[i = where, j = select, by = group by, ...]</code> is similar to SQL <code>where, select, group by</code> statements</li>
<li>Fastest in memory data manipulation tool in R
<ul>
<li>Include plot of benchmark?</li>
<li>Time is Money, Money is Power, Power is Pizza</li>
</ul></li>
<li>Active community on StackOverflow, so your question is most likely answered already on it</li>
</ul>
</section><section id="load-packages-before-we-start" class="slide level2">
<h2>Load packages before we start</h2>
<p>Note, this next code block will install the <code>data.table</code> package if it is not already installed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(data.table)) <span class="kw">install.packages</span>(<span class="st">&quot;data.table&quot;</span>)</code></pre></div>
<pre><code>## Loading required package: data.table</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)</code></pre></div>
</section></section>
<section><section id="data.table-is-very-similar-to-data.frame" class="titleslide slide level1"><h1>data.table is very similar to data.frame</h1></section><section id="create-tables" class="slide level2">
<h2>Create tables</h2>
<p>This block creates a list of approximately one million auto claims allocated to 1966–2015, so all are assumed at ultimate. To test the speed of reading files into R, the file has already been created and saved as <code>SampleAutoLosses.csv</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">354</span>)
years &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1966</span>, <span class="dv">2015</span>)
counts &lt;-<span class="st"> </span><span class="kw">rnbinom</span>(<span class="kw">length</span>(years), <span class="dt">size =</span> <span class="dv">3000</span>, <span class="dt">mu =</span> <span class="dv">20000</span>)
allCounts &lt;-<span class="st"> </span><span class="kw">sum</span>(counts)
smallCounts &lt;-<span class="st"> </span><span class="kw">floor</span>(<span class="fl">0.7</span> <span class="op">*</span><span class="st"> </span>allCounts)
bigCounts &lt;-<span class="st"> </span>allCounts <span class="op">-</span><span class="st"> </span>smallCounts
numPassBig &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq_len</span>(<span class="dv">6</span>), bigCounts, <span class="dt">replace =</span> <span class="ot">TRUE</span>,
                     <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.4</span>, <span class="fl">0.2</span>, <span class="fl">0.15</span>, <span class="fl">0.1</span>, <span class="fl">0.08</span>, <span class="fl">0.07</span>))
numPassSmall &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq_len</span>(<span class="dv">3</span>), smallCounts, <span class="dt">replace =</span> <span class="ot">TRUE</span>,
                       <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.7</span>, <span class="fl">0.25</span>, .<span class="dv">05</span>))
smallLosses &lt;-<span class="st"> </span><span class="kw">rgamma</span>(smallCounts, <span class="dt">shape =</span> <span class="dv">4</span>, <span class="dt">scale =</span> <span class="dv">2500</span>)
bigLosses &lt;-<span class="st"> </span><span class="kw">rgamma</span>(bigCounts, <span class="dt">shape =</span> <span class="fl">0.5</span>, <span class="dt">scale =</span> <span class="fl">1e6</span>)
sLosses_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Loss =</span> smallLosses, <span class="dt">Pass =</span> numPassSmall)
bLosses_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Loss =</span> bigLosses, <span class="dt">Pass =</span> numPassBig)
aLosses_df &lt;-<span class="st"> </span><span class="kw">rbind</span>(sLosses_df, bLosses_df)
losses_df &lt;-<span class="st"> </span>aLosses_df[<span class="kw">sample</span>(<span class="kw">nrow</span>(aLosses_df)), ]
<span class="kw">row.names</span>(losses_df) &lt;-<span class="st"> </span><span class="ot">NULL</span>
ALAE_P =<span class="st"> </span><span class="kw">rlnorm</span>(allCounts, <span class="dt">meanlog =</span> <span class="kw">log</span>(<span class="fl">0.1</span>) <span class="op">-</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">5</span>) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>,
                <span class="dt">sdlog =</span> <span class="kw">sqrt</span>(<span class="kw">log</span>(<span class="dv">5</span>)))
ALAE =<span class="st"> </span>losses_df<span class="op">$</span>Loss <span class="op">*</span><span class="st"> </span>ALAE_P
writeStates &lt;-<span class="st"> </span>state.abb[state.division <span class="op">%in%</span>
<span class="st">                           </span><span class="kw">c</span>(<span class="st">&#39;New England&#39;</span>, <span class="st">&#39;Middle Atlantic&#39;</span>, <span class="st">&#39;South Atlantic&#39;</span>)]
losses_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Year =</span> <span class="kw">rep</span>(years, counts), <span class="dt">Loss =</span> <span class="kw">round</span>(losses_df<span class="op">$</span>Loss, <span class="dv">0</span>),
                        <span class="dt">ALAE =</span> <span class="kw">round</span>(ALAE, <span class="dv">0</span>), <span class="dt">Pass =</span> losses_df<span class="op">$</span>Pass,
                        <span class="dt">State =</span> <span class="kw">sample</span>(writeStates, allCounts, <span class="dt">replace =</span> <span class="ot">TRUE</span>))</code></pre></div>
</section><section id="read-data" class="slide level2">
<h2>Read Data</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">colClass &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;integer&#39;</span>, <span class="kw">rep</span>(<span class="st">&#39;numeric&#39;</span>, <span class="dv">2</span>), <span class="st">&#39;integer&#39;</span>, <span class="st">&#39;character&#39;</span>)
df_T &lt;-<span class="st"> </span><span class="kw">system.time</span>(df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;./SampleAutoLosses.csv&#39;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>,
                             <span class="dt">colClasses =</span> colClass))
dt_T &lt;-<span class="st"> </span><span class="kw">system.time</span>(dt &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&#39;./SampleAutoLosses.csv&#39;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>,
                             <span class="dt">colClasses =</span> colClass))
df_T</code></pre></div>
<pre><code>##    user  system elapsed 
##    2.23    0.15    2.39</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt_T</code></pre></div>
<pre><code>##    user  system elapsed 
##    0.73    0.02    0.75</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(df)</code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(dt)</code></pre></div>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<ul>
<li><code>setDT</code> is very useful when working with large dataset as it avoids copying. For more information, read the discussion on <a href="https://stackoverflow.com/questions/41917887/when-should-i-use-setdt-instead-of-data-table-to-create-a-data-table">stackoverflow</a>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setDT</span>(df) <span class="co"># modifies df to become a data.table in place without copying</span>
<span class="kw">class</span>(df)</code></pre></div>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(df)
<span class="kw">class</span>(df)</code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
</section><section id="looking-at-the-data.table" class="slide level2">
<h2>Looking at the data.table</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(df)</code></pre></div>
<pre><code>##       Year           Loss               ALAE               Pass      
##  Min.   :1966   Min.   :       0   Min.   :       0   Min.   :1.000  
##  1st Qu.:1978   1st Qu.:    7097   1st Qu.:     205   1st Qu.:1.000  
##  Median :1990   Median :   11320   Median :     656   Median :1.000  
##  Mean   :1990   Mean   :  157321   Mean   :   15644   Mean   :1.686  
##  3rd Qu.:2003   3rd Qu.:   26621   3rd Qu.:    3002   3rd Qu.:2.000  
##  Max.   :2015   Max.   :14398043   Max.   :19869346   Max.   :6.000  
##     State          
##  Length:1004977    
##  Class :character  
##  Mode  :character  
##                    
##                    
## </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(dt)</code></pre></div>
<pre><code>##       Year           Loss               ALAE               Pass      
##  Min.   :1966   Min.   :       0   Min.   :       0   Min.   :1.000  
##  1st Qu.:1978   1st Qu.:    7097   1st Qu.:     205   1st Qu.:1.000  
##  Median :1990   Median :   11320   Median :     656   Median :1.000  
##  Mean   :1990   Mean   :  157321   Mean   :   15644   Mean   :1.686  
##  3rd Qu.:2003   3rd Qu.:   26621   3rd Qu.:    3002   3rd Qu.:2.000  
##  Max.   :2015   Max.   :14398043   Max.   :19869346   Max.   :6.000  
##     State          
##  Length:1004977    
##  Class :character  
##  Mode  :character  
##                    
##                    
## </code></pre>
</section><section id="row-subsets" class="slide level2">
<h2>Row subsets</h2>
<ul>
<li>row filters using slices <code>:</code> inside <code>[i, ]</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># returns row 1 to 3 </span>
df[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, ]</code></pre></div>
<pre><code>##   Year  Loss ALAE Pass State
## 1 1966  4970  407    2    FL
## 2 1966  5483  331    1    RI
## 3 1966 10317  307    1    MA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, ]</code></pre></div>
<pre><code>##    Year  Loss ALAE Pass State
## 1: 1966  4970  407    2    FL
## 2: 1966  5483  331    1    RI
## 3: 1966 10317  307    1    MA</code></pre>
</section><section id="row-subsets-different-from-data.frame" class="slide level2">
<h2>Row subsets different from data.frame</h2>
<ul>
<li>Filter based on column name - less typing than data.frame</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df[df<span class="op">$</span>State <span class="op">==</span><span class="st"> &#39;NY&#39;</span>, ], <span class="dv">5</span>)</code></pre></div>
<pre><code>##    Year   Loss ALAE Pass State
## 33 1966   4510  435    1    NY
## 59 1966 968011 4084    1    NY
## 62 1966   5914  650    3    NY
## 63 1966  22052 2538    2    NY
## 79 1966 200469 6712    1    NY</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt[State <span class="op">==</span><span class="st"> &#39;NY&#39;</span>, ], <span class="dv">5</span>)</code></pre></div>
<pre><code>##    Year   Loss ALAE Pass State
## 1: 1966   4510  435    1    NY
## 2: 1966 968011 4084    1    NY
## 3: 1966   5914  650    3    NY
## 4: 1966  22052 2538    2    NY
## 5: 1966 200469 6712    1    NY</code></pre>
</section><section id="row-subsets-different-to-data.frame---cont." class="slide level2">
<h2>Row subsets different to data.frame - Cont.</h2>
<ul>
<li>Using secondary index <code>on</code> notation - this is faster than normal subset above
<ul>
<li>Read more about secondary index in the <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-secondary-indices-and-auto-indexing.html">vignette</a></li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt[<span class="st">&#39;NY&#39;</span>, <span class="dt">on =</span> <span class="st">&#39;State&#39;</span>], <span class="dv">5</span>)</code></pre></div>
<pre><code>##    Year   Loss ALAE Pass State
## 1: 1966   4510  435    1    NY
## 2: 1966 968011 4084    1    NY
## 3: 1966   5914  650    3    NY
## 4: 1966  22052 2538    2    NY
## 5: 1966 200469 6712    1    NY</code></pre>
</section><section id="column-selects---using-names" class="slide level2">
<h2>Column selects - using names</h2>
<ul>
<li>Notice that <code>df</code> returns a vector instead of data.frame</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df[, <span class="st">&#39;Loss&#39;</span>], <span class="dv">5</span>)</code></pre></div>
<pre><code>## [1]  4970  5483 10317 10654 61374</code></pre>
<ul>
<li><code>dt</code> returns a single column data.table, <code>data.table</code> tries to be consistent in returning data.table object from user operation</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt[, <span class="st">&#39;Loss&#39;</span>], <span class="dv">5</span>)</code></pre></div>
<pre><code>##     Loss
## 1:  4970
## 2:  5483
## 3: 10317
## 4: 10654
## 5: 61374</code></pre>
</section><section id="column-selects---using-names---cont." class="slide level2">
<h2>Column selects - using names - Cont.</h2>
<ul>
<li>To return a vector from a data.table, one can use the following</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df[[<span class="st">&#39;Loss&#39;</span>]], <span class="dv">5</span>)</code></pre></div>
<pre><code>## [1]  4970  5483 10317 10654 61374</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df<span class="op">$</span>Loss, <span class="dv">5</span>)</code></pre></div>
<pre><code>## [1]  4970  5483 10317 10654 61374</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt[[<span class="st">&#39;Loss&#39;</span>]], <span class="dv">5</span>)</code></pre></div>
<pre><code>## [1]  4970  5483 10317 10654 61374</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt<span class="op">$</span>Loss, <span class="dv">5</span>)</code></pre></div>
<pre><code>## [1]  4970  5483 10317 10654 61374</code></pre>
</section><section id="column-selects---multiple-names" class="slide level2">
<h2>Column selects - multiple names</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df[, <span class="kw">c</span>(<span class="st">&#39;Loss&#39;</span>, <span class="st">&#39;ALAE&#39;</span>)], <span class="dv">5</span>)</code></pre></div>
<pre><code>##    Loss ALAE
## 1  4970  407
## 2  5483  331
## 3 10317  307
## 4 10654  217
## 5 61374 1300</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt[, <span class="kw">c</span>(<span class="st">&#39;Loss&#39;</span>, <span class="st">&#39;ALAE&#39;</span>)], <span class="dv">5</span>)</code></pre></div>
<pre><code>##     Loss ALAE
## 1:  4970  407
## 2:  5483  331
## 3: 10317  307
## 4: 10654  217
## 5: 61374 1300</code></pre>
</section><section id="column-selects---using-numbers" class="slide level2">
<h2>Column selects - using numbers</h2>
<ul>
<li>Although selecting by column number is not good practice in general, it is supported to help data.frame users transition more smoothly to data.table</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df[, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">5</span>)</code></pre></div>
<pre><code>##   Year  Loss ALAE
## 1 1966  4970  407
## 2 1966  5483  331
## 3 1966 10317  307
## 4 1966 10654  217
## 5 1966 61374 1300</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt[, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">5</span>)</code></pre></div>
<pre><code>##    Year  Loss ALAE
## 1: 1966  4970  407
## 2: 1966  5483  331
## 3: 1966 10317  307
## 4: 1966 10654  217
## 5: 1966 61374 1300</code></pre>
</section><section id="column-selects-different-to-data.frame---use-list" class="slide level2">
<h2>Column selects different to data.frame - use list</h2>
<ul>
<li><code>.()</code> is an alias for <code>list()</code>, this shortens the syntax</li>
<li>You don’t need to have quotation mark around the column names</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt[, <span class="kw">list</span>(Loss, ALAE)], <span class="dv">5</span>)</code></pre></div>
<pre><code>##     Loss ALAE
## 1:  4970  407
## 2:  5483  331
## 3: 10317  307
## 4: 10654  217
## 5: 61374 1300</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt[, .(Loss, ALAE)], <span class="dv">5</span>)</code></pre></div>
<pre><code>##     Loss ALAE
## 1:  4970  407
## 2:  5483  331
## 3: 10317  307
## 4: 10654  217
## 5: 61374 1300</code></pre>
</section><section id="column-selects-different-to-data.table---variable-approach-with-mget-or-.." class="slide level2">
<h2>Column selects different to data.table - variable approach with <code>mget</code> or <code>..</code></h2>
<ul>
<li>This is useful when you have several columns you want to select and don’t want to clutter your data.table operation</li>
<li>Or you are passing variables in a function call</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cols_to_select &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Loss&#39;</span>, <span class="st">&#39;ALAE&#39;</span>, <span class="st">&#39;State&#39;</span>)
<span class="kw">head</span>(df[, cols_to_select], <span class="dv">5</span>)</code></pre></div>
<pre><code>##   Year  Loss ALAE State
## 1 1966  4970  407    FL
## 2 1966  5483  331    RI
## 3 1966 10317  307    MA
## 4 1966 10654  217    VA
## 5 1966 61374 1300    SC</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#head(dt[, cols_to_select], 5) # because you can call column name directly, data.table will try to look for cols_to_select as a column in the table</span>
<span class="co"># Error in `[.data.table`(dt, , cols_to_select) : j...</span></code></pre></div>
</section><section id="column-selects-different-to-data.table---variable-approach-with-mget-or-..---cont." class="slide level2">
<h2>Column selects different to data.table - variable approach with <code>mget</code> or <code>..</code> - Cont.</h2>
<ul>
<li>Use <code>mget</code> to get the column names in the correct scope</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt[, <span class="kw">mget</span>(cols_to_select)], <span class="dv">5</span>)</code></pre></div>
<pre><code>##    Year  Loss ALAE State
## 1: 1966  4970  407    FL
## 2: 1966  5483  331    RI
## 3: 1966 10317  307    MA
## 4: 1966 10654  217    VA
## 5: 1966 61374 1300    SC</code></pre>
<ul>
<li>Use <code>..</code> to achieve the same result</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt[, ..cols_to_select], <span class="dv">5</span>)</code></pre></div>
<pre><code>##    Year  Loss ALAE State
## 1: 1966  4970  407    FL
## 2: 1966  5483  331    RI
## 3: 1966 10317  307    MA
## 4: 1966 10654  217    VA
## 5: 1966 61374 1300    SC</code></pre>
</section></section>
<section><section id="how-to-add-columns-to-a-data.table" class="titleslide slide level1"><h1>How to add columns to a data.table</h1></section><section id="adding-and-deleting-columns-by-reference" class="slide level2">
<h2>Adding and deleting columns by reference</h2>
<ul>
<li>Like most data.table operations, adding columns are done by reference. Which means that each time a column is added or changed, there isn’t a need to copy the existing data frame and make the adjustment on the copy. This provides some optimization in terms of speed, and significant optimization in terms of memory, allowing data tables to be much larger yet “fit” in R’s memory. Setting column orders are also done by reference, for speed and memory purposes.</li>
</ul>
</section><section id="notation" class="slide level2">
<h2><code>:=</code> notation</h2>
<p>The operator used to edit columns in a data table is <code>:=</code>. Deleting a column is as simple as passing <code>NULL</code> as the column value.</p>
<ul>
<li>Caveat: The data.table package does not use as much lazy and non-standard evaluation as <code>dplyr</code>. Therefore, unlike <code>dplyr::mutate</code>, you can only reference an added column in a data.table after it has been assigned, not in the same call. However, as one can chain data.table calls, this is not really a serious issue.</li>
</ul>
</section><section id="add-new-column-based-on-existing-columns" class="slide level2">
<h2>Add new column based on existing columns</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt[, ALAE_P <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(ALAE <span class="op">/</span><span class="st"> </span>Loss, <span class="dv">3</span>)]
<span class="kw">head</span>(dt)</code></pre></div>
<pre><code>##    Year  Loss ALAE Pass State ALAE_P
## 1: 1966  4970  407    2    FL  0.082
## 2: 1966  5483  331    1    RI  0.060
## 3: 1966 10317  307    1    MA  0.030
## 4: 1966 10654  217    1    VA  0.020
## 5: 1966 61374 1300    2    SC  0.021
## 6: 1966 12197 2124    1    WV  0.174</code></pre>
</section><section id="reorder-columns-by-reference" class="slide level2">
<h2>Reorder columns by reference</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setcolorder</span>(dt, <span class="kw">c</span>(<span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Loss&#39;</span>, <span class="st">&#39;ALAE&#39;</span>, <span class="st">&#39;ALAE_P&#39;</span>, <span class="st">&#39;Pass&#39;</span>, <span class="st">&#39;State&#39;</span>))
dt</code></pre></div>
<pre><code>##          Year    Loss  ALAE ALAE_P Pass State
##       1: 1966    4970   407  0.082    2    FL
##       2: 1966    5483   331  0.060    1    RI
##       3: 1966   10317   307  0.030    1    MA
##       4: 1966   10654   217  0.020    1    VA
##       5: 1966   61374  1300  0.021    2    SC
##      ---                                     
## 1004973: 2015    5722     2  0.000    1    NC
## 1004974: 2015    1187   244  0.206    1    RI
## 1004975: 2015    4729  2853  0.603    2    VA
## 1004976: 2015  255422 21455  0.084    2    FL
## 1004977: 2015 1281835  2497  0.002    1    WV</code></pre>
</section><section id="delete-a-column" class="slide level2">
<h2>Delete a column</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt[, ALAE_P <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>][]</code></pre></div>
<pre><code>##          Year    Loss  ALAE Pass State
##       1: 1966    4970   407    2    FL
##       2: 1966    5483   331    1    RI
##       3: 1966   10317   307    1    MA
##       4: 1966   10654   217    1    VA
##       5: 1966   61374  1300    2    SC
##      ---                              
## 1004973: 2015    5722     2    1    NC
## 1004974: 2015    1187   244    1    RI
## 1004975: 2015    4729  2853    2    VA
## 1004976: 2015  255422 21455    2    FL
## 1004977: 2015 1281835  2497    1    WV</code></pre>
</section><section id="add-new-column-from-a-vector" class="slide level2">
<h2>Add new column from a vector</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt[, Region <span class="op">:</span><span class="er">=</span><span class="st"> </span>state.division[State <span class="op">==</span><span class="st"> </span>state.abb], by =<span class="st"> </span>State][]</code></pre></div>
<pre><code>##          Year    Loss  ALAE Pass State         Region
##       1: 1966    4970   407    2    FL South Atlantic
##       2: 1966    5483   331    1    RI    New England
##       3: 1966   10317   307    1    MA    New England
##       4: 1966   10654   217    1    VA South Atlantic
##       5: 1966   61374  1300    2    SC South Atlantic
##      ---                                             
## 1004973: 2015    5722     2    1    NC South Atlantic
## 1004974: 2015    1187   244    1    RI    New England
## 1004975: 2015    4729  2853    2    VA South Atlantic
## 1004976: 2015  255422 21455    2    FL South Atlantic
## 1004977: 2015 1281835  2497    1    WV South Atlantic</code></pre>
</section><section id="summarize-mean-median-max-etc-with-group-by" class="slide level2">
<h2>Summarize (mean, median, max, etc) with “group by”</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt[, .(<span class="dt">Counts =</span> .N, <span class="dt">Avg =</span> <span class="kw">mean</span>(Loss), <span class="dt">Max =</span> <span class="kw">max</span>(Loss),
       <span class="dt">MedPass =</span> <span class="kw">median</span>(Pass)), by =<span class="st"> </span>Region]</code></pre></div>
<pre><code>##             Region Counts      Avg      Max MedPass
## 1:  South Atlantic 472803 156829.7 14398043       1
## 2:     New England 355219 158394.2  8456268       1
## 3: Middle Atlantic 176955 156479.1  8557035       1</code></pre>
</section><section id="summarize-by-multiple-columns" class="slide level2">
<h2>Summarize by multiple columns</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dt[, .(<span class="dt">Counts =</span> .N, <span class="dt">Avg =</span> <span class="kw">mean</span>(Loss), <span class="dt">Max =</span> <span class="kw">max</span>(Loss)),
        <span class="dt">keyby =</span> <span class="kw">c</span>(<span class="st">&#39;Region&#39;</span>, <span class="st">&#39;Pass&#39;</span>)])</code></pre></div>
<pre><code>##         Region Pass Counts      Avg     Max
## 1: New England    1 216595 107121.1 8403760
## 2: New England    2  83535 136043.0 8456268
## 3: New England    3  28534 284892.8 7459513
## 4: New England    4  10563 511985.8 8140141
## 5: New England    5   8519 517472.3 7897216
## 6: New England    6   7473 502181.6 6431055</code></pre>
<ul>
<li>We will see more of <code>keyby</code> later</li>
</ul>
</section><section id="list-notation" class="slide level2">
<h2>list notation</h2>
<ul>
<li>When wanting to add or delete multiple columns in a data frame, it is easiest to use “functional” notation. In this case, the <code>:=</code> operator is added before a parenthetical list of column name–data pairs. Inside the parentheses, only a normal <code>=</code> is used, as the specialized assigment operator will be applied to each pair.</li>
</ul>
</section><section id="adding-columns" class="slide level2">
<h2>Adding columns</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span> (<span class="dt">ALAE_P =</span> <span class="kw">round</span>(ALAE <span class="op">/</span><span class="st"> </span>Loss, <span class="dv">3</span>), <span class="dt">Multiple =</span> Pass <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)]
<span class="kw">head</span>(dt)</code></pre></div>
<pre><code>##    Year  Loss ALAE Pass State         Region ALAE_P Multiple
## 1: 1966  4970  407    2    FL South Atlantic  0.082     TRUE
## 2: 1966  5483  331    1    RI    New England  0.060    FALSE
## 3: 1966 10317  307    1    MA    New England  0.030    FALSE
## 4: 1966 10654  217    1    VA South Atlantic  0.020    FALSE
## 5: 1966 61374 1300    2    SC South Atlantic  0.021     TRUE
## 6: 1966 12197 2124    1    WV South Atlantic  0.174    FALSE</code></pre>
</section><section id="deleting-columns" class="slide level2">
<h2>Deleting columns</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span> (<span class="dt">ALAE_P =</span> <span class="ot">NULL</span>, <span class="dt">Multiple =</span> <span class="ot">NULL</span>)]
<span class="kw">head</span>(dt)</code></pre></div>
<pre><code>##    Year  Loss ALAE Pass State         Region
## 1: 1966  4970  407    2    FL South Atlantic
## 2: 1966  5483  331    1    RI    New England
## 3: 1966 10317  307    1    MA    New England
## 4: 1966 10654  217    1    VA South Atlantic
## 5: 1966 61374 1300    2    SC South Atlantic
## 6: 1966 12197 2124    1    WV South Atlantic</code></pre>
</section></section>
<section><section id="how-to-join-tables-together-using-data.table" class="titleslide slide level1"><h1>How to join tables together using data.table</h1></section><section id="keys" class="slide level2">
<h2>Keys</h2>
<ul>
<li>One of the optimizations of data table is its implementation of an optimized radix sort. This is further enhanced when a key is set. When setting a key or keys, the actual order of the table is re-written to conform to the keys, making future searches blazingly fast.</li>
</ul>
</section><section class="slide level2">

<ul>
<li>Create ancillary table</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">policy_dt &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">Year =</span> years,
                        <span class="dt">Policies =</span> <span class="kw">rnbinom</span>(<span class="kw">length</span>(years),
                                           <span class="dt">mu =</span> <span class="dv">10000</span>, <span class="dt">size =</span> <span class="dv">100</span>))
policy_dt &lt;-<span class="st"> </span><span class="kw">data.table</span>(policy_dt, <span class="dt">Premium =</span> 
                          <span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="kw">nrow</span>(policy_dt), <span class="dt">mean =</span> <span class="dv">100</span>,
                                      <span class="dt">sd =</span> <span class="dv">20</span>) <span class="op">*</span><span class="st"> </span>policy_dt<span class="op">$</span>Policies, <span class="dv">0</span>))
<span class="kw">head</span>(policy_dt)</code></pre></div>
<pre><code>##    Year Policies Premium
## 1: 1966    11272 1170711
## 2: 1967    10282  980969
## 3: 1968     9081  712755
## 4: 1969    10224 1255788
## 5: 1970    10382  951662
## 6: 1971     8634  904854</code></pre>
</section><section id="joins" class="slide level2">
<h2>Joins</h2>
<ul>
<li>We want to merge the policy data with the loss data to get the overall loss ratio by year</li>
<li>It will be fastest if there are shared key fields</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setkey</span>(dt, Year, State)
<span class="kw">setkey</span>(policy_dt, Year)</code></pre></div>
</section><section id="join" class="slide level2">
<h2>Join</h2>
<ul>
<li>Details about specific kinds of joins and how to perform them are found in the data.table help documentation and vignettes.</li>
<li><code>[</code> notation</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">joint_dt &lt;-<span class="st"> </span>dt[policy_dt]
<span class="kw">setkey</span>(joint_dt, Year, State)</code></pre></div>
<ul>
<li>merge</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">joint_dt2 &lt;-<span class="st"> </span><span class="kw">merge</span>(dt, policy_dt)
<span class="kw">setkey</span>(joint_dt2, Year, State)
<span class="kw">all.equal</span>(joint_dt, joint_dt2)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</section><section id="set-operations-on-data.frames" class="slide level2">
<h2>Set operations on data.frames</h2>
<ul>
<li>Split policy data into two overlapping and recombine:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1_dt &lt;-<span class="st"> </span>policy_dt[Year <span class="op">%in%</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">1966</span>, <span class="dv">1994</span>)]
p2_dt &lt;-<span class="st"> </span>policy_dt[Year <span class="op">%in%</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">1985</span>, <span class="dv">2015</span>)]
pT_dt &lt;-<span class="st"> </span><span class="kw">funion</span>(p1_dt, p2_dt)
<span class="kw">setkey</span>(pT_dt, Year)
<span class="kw">all.equal</span>(pT_dt, policy_dt)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pO_dt &lt;-<span class="st"> </span><span class="kw">fintersect</span>(p1_dt, p2_dt)
<span class="kw">dim</span>(pO_dt)</code></pre></div>
<pre><code>## [1] 10  3</code></pre>
</section></section>
<section><section id="how-to-do-a-sql-transform-and-back-in-data.table" class="titleslide slide level1"><h1>How to do a SQL <code>transform</code> (and back) in data.table</h1></section><section id="reshaping-data.tables" class="slide level2">
<h2>Reshaping data.tables</h2>
<ul>
<li>Package has very quick implementation of dcast and melt from reshape2</li>
<li>For example, useful in ggplot for faceting LR and Count</li>
</ul>
</section><section id="simple-plot" class="slide level2">
<h2>Simple plot</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(LR, <span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> LR, <span class="dt">color =</span> Region)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="data.table_primer_files/figure-revealjs/simpleplot-1.png" width="768" /></p>
</section><section id="pivot-table-from-wide-to-long" class="slide level2">
<h2>Pivot table from wide to long</h2>
<ul>
<li>melt</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">LR2 &lt;-<span class="st"> </span><span class="kw">melt</span>(LR, <span class="dt">measure.vars =</span> <span class="kw">c</span>(<span class="st">&#39;LR&#39;</span>, <span class="st">&#39;Count&#39;</span>))</code></pre></div>
<pre><code>## Warning in melt.data.table(LR, measure.vars = c(&quot;LR&quot;, &quot;Count&quot;)):
## &#39;measure.vars&#39; [LR, Count] are not all of the same type. By order of
## hierarchy, the molten data value column will be of type &#39;double&#39;. All
## measure variables not of type &#39;double&#39; will be coerced to. Check DETAILS
## in ?melt.data.table for more on coercion.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(LR2)</code></pre></div>
<pre><code>##    Year      Region State variable     value
## 1: 1966 New England    CT       LR 0.1578179
## 2: 1966 New England    MA       LR 0.1138696
## 3: 1966 New England    ME       LR 0.1285288
## 4: 1966 New England    NH       LR 0.1423237
## 5: 1966 New England    RI       LR 0.1330101
## 6: 1966 New England    VT       LR 0.1525566</code></pre>
</section><section class="slide level2">

<ul>
<li>Now that data is melted, call faceted plot</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(LR2, <span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> value, <span class="dt">color =</span> Region)) <span class="op">+</span><span class="st"> </span><span class="kw">stat_smooth</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>variable, <span class="dt">scales =</span> <span class="st">&#39;free_y&#39;</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="data.table_primer_files/figure-revealjs/facetplot-1.png" width="768" /></p>
</section><section id="pivot-table-from-long-to-wide" class="slide level2">
<h2>Pivot table from long to wide</h2>
<ul>
<li>dcast</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">LR3 &lt;-<span class="st"> </span><span class="kw">dcast</span>(LR2, Year <span class="op">+</span><span class="st"> </span>Region <span class="op">+</span><span class="st"> </span>State <span class="op">~</span><span class="st"> </span>variable)
<span class="kw">setkey</span>(LR3, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Region&#39;</span>, <span class="st">&#39;State&#39;</span>)
<span class="kw">all.equal</span>(LR, LR3)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(LR3)</code></pre></div>
<pre><code>##    Year      Region State        LR Count
## 1: 1966 New England    CT 0.1578179  1176
## 2: 1966 New England    MA 0.1138696  1112
## 3: 1966 New England    ME 0.1285288  1196
## 4: 1966 New England    NH 0.1423237  1178
## 5: 1966 New England    RI 0.1330101  1178
## 6: 1966 New England    VT 0.1525566  1182</code></pre>
</section></section>
<section><section id="work-with-data.table-using-variables" class="titleslide slide level1"><h1>Work with data.table using variables</h1></section><section id="passing-variables-to-data.table" class="slide level2">
<h2>Passing variables to data.table</h2>
<ul>
<li>Inside a function using get/mget</li>
<li>Applying functions to multiple columns (<code>.SD, .SDcols</code>)</li>
</ul>
</section></section>
    </div>
  </div>

  <script src="data.table_primer_files/reveal.js-3.3.0.1/lib/js/head.min.js"></script>
  <script src="data.table_primer_files/reveal.js-3.3.0.1/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: false,
        // Transition style
        transition: 'default', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom

        menu: {
          numbers: true,
          custom: false,
          themes: false,
          transitions: false
        },



        chalkboard: {
        },

        keyboard: {
          67: function() { RevealChalkboard.toggleNotesCanvas() },    // toggle notes canvas when 'c' is pressed
          66: function() { RevealChalkboard.toggleChalkboard() }, // toggle chalkboard when 'b' is pressed
          46: function() { RevealChalkboard.clear() },    // clear chalkboard when 'DEL' is pressed
           8: function() { RevealChalkboard.reset() },    // reset chalkboard data on current slide when 'BACKSPACE' is pressed
          68: function() { RevealChalkboard.download() }, // downlad recorded chalkboard drawing when 'd' is pressed
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: 'data.table_primer_files/reveal.js-3.3.0.1/plugin/chalkboard/chalkboard.js', async: true },
          { src: 'data.table_primer_files/reveal.js-3.3.0.1/plugin/menu/menu.js', async: true },
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
